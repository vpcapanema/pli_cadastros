<!-- Componente de Navegação Reutilizável -->
<!-- Para incluir: use JavaScript para carregar ou server-side includes -->

<nav class="navbar navbar-expand-lg pli-navbar fixed-top">
    <div class="container-fluid">
        <!-- Logo e nome do sistema -->
        <a class="navbar-brand pli-navbar-brand d-flex align-items-center" href="dashboard.html">
            <i class="fas fa-users me-2"></i>
            <span class="fw-bold">Sistema PLI</span>
        </a>

        <!-- Botão para mobile -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain" 
                aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Menu principal -->
        <div class="collapse navbar-collapse" id="navbarMain">
            <!-- Menu à esquerda -->
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="dashboard.html" data-page="dashboard">
                        <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="cadastrosDropdown" role="button" 
                       data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-user-plus me-1"></i>Cadastros
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a class="dropdown-item" href="pessoa-fisica.html" data-page="pessoa-fisica">
                                <i class="fas fa-user me-2"></i>Pessoa Física
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="pessoa-juridica.html" data-page="pessoa-juridica">
                                <i class="fas fa-building me-2"></i>Pessoa Jurídica
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="usuarios.html" data-page="usuarios">
                        <i class="fas fa-users-cog me-1"></i>Usuários
                    </a>
                </li>
            </ul>

            <!-- Menu à direita -->
            <ul class="navbar-nav">
                <!-- Notificações -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle position-relative" href="#" id="notificationsDropdown" title="Notificações" 
                       role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-bell"></i>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" 
                              id="notificationCount">0</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end notification-dropdown">
                        <li class="dropdown-header">
                            <i class="fas fa-bell me-2"></i>Notificações
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li class="px-3 py-2" id="notificationsList">
                            <small class="text-muted">Nenhuma notificação</small>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li class="text-center">
                            <a class="dropdown-item small" href="#" id="markAllRead">
                                <i class="fas fa-check-double me-1"></i>Marcar todas como lidas
                            </a>
                        </li>
                    </ul>
                </li>

                <!-- Perfil do usuário -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" 
                       role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <div class="bg-white rounded-circle d-flex align-items-center justify-content-center me-2 avatar-sm">
                            <i class="fas fa-user text-primary"></i>
                        </div>
                        <span id="userName">Usuário</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li class="dropdown-header">
                            <div class="d-flex align-items-center">
                                <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-2 avatar-md">
                                    <i class="fas fa-user text-white"></i>
                                </div>
                                <div>
                                    <div class="fw-bold" id="userNameFull">Nome do Usuário</div>
                                    <small class="text-muted" id="userEmail">email@exemplo.com</small>
                                </div>
                            </div>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item" href="#" onclick="openProfileModal()">
                                <i class="fas fa-user-edit me-2"></i>Editar Perfil
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="#" onclick="openChangePasswordModal()">
                                <i class="fas fa-lock me-2"></i>Alterar Senha
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="#" onclick="toggleTheme()">
                                <i class="fas fa-palette me-2"></i>Tema
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item text-danger" href="#" onclick="logout()">
                                <i class="fas fa-sign-out-alt me-2"></i>Sair
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Espaçamento para navbar fixa -->
<div class="navbar-spacer"></div>

<script>
// Script para ativar item atual do menu
document.addEventListener('DOMContentLoaded', function() {
    const currentPage = window.location.pathname.split('/').pop().replace('.html', '');
    const navLinks = document.querySelectorAll('[data-page]');
    
    navLinks.forEach(link => {
        if (link.dataset.page === currentPage) {
            link.classList.add('active');
            
            // Se for um item de dropdown, ativa o parent também
            const dropdown = link.closest('.dropdown');
            if (dropdown) {
                dropdown.querySelector('.nav-link').classList.add('active');
            }
        }
    });
    
    // Carrega informações do usuário
    loadUserInfo();
    loadNotifications();
});

/**
 * Carrega informações do usuário logado
 */
function loadUserInfo() {
    const userData = JSON.parse(localStorage.getItem('user') || '{}');
    
    if (userData.nome) {
        document.getElementById('userName').textContent = userData.nome.split(' ')[0];
        document.getElementById('userNameFull').textContent = userData.nome;
        document.getElementById('userEmail').textContent = userData.email || 'email@exemplo.com';
    }
}

/**
 * Carrega notificações do usuário
 */
function loadNotifications() {
    // Simulação - em produção viria da API
    const notifications = [
        {
            id: 1,
            title: 'Novo cadastro pendente',
            message: 'Pessoa física aguardando aprovação',
            time: '5 min atrás',
            read: false
        }
    ];
    
    updateNotificationsBadge(notifications);
    renderNotifications(notifications);
}

/**
 * Atualiza badge de notificações
 */
function updateNotificationsBadge(notifications) {
    const unreadCount = notifications.filter(n => !n.read).length;
    const badge = document.getElementById('notificationCount');
    
    if (unreadCount > 0) {
        badge.textContent = unreadCount;
        badge.style.display = 'block';
    } else {
        badge.style.display = 'none';
    }
}

/**
 * Renderiza lista de notificações
 */
function renderNotifications(notifications) {
    const container = document.getElementById('notificationsList');
    
    if (notifications.length === 0) {
        container.innerHTML = '<small class="text-muted">Nenhuma notificação</small>';
        return;
    }
    
    container.innerHTML = notifications.map(notification => `
        <div class="notification-item py-2 ${!notification.read ? 'bg-light' : ''}">
            <div class="d-flex justify-content-between align-items-start">
                <div class="flex-grow-1">
                    <div class="fw-bold small">${notification.title}</div>
                    <div class="text-muted small">${notification.message}</div>
                    <div class="text-muted" style="font-size: 0.75rem;">${notification.time}</div>
                </div>
                ${!notification.read ? '<div class="bg-primary rounded-circle" style="width: 8px; height: 8px;"></div>' : ''}
            </div>
        </div>
    `).join('');
}

/**
 * Abre modal de edição de perfil
 */
function openProfileModal() {
    // Implementar modal de perfil
    console.log('Abrir modal de perfil');
}

/**
 * Abre modal de alteração de senha
 */
function openChangePasswordModal() {
    // Implementar modal de senha
    console.log('Abrir modal de senha');
}

/**
 * Alterna tema da aplicação
 */
function toggleTheme() {
    const currentTheme = localStorage.getItem('theme') || 'light';
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    
    localStorage.setItem('theme', newTheme);
    document.body.setAttribute('data-theme', newTheme);
}

/**
 * Realiza logout do usuário
 */
function logout() {
    if (confirm('Tem certeza que deseja sair do sistema?')) {
        localStorage.removeItem('user');
        localStorage.removeItem('token');
        window.location.href = 'login.html';
    }
}

/**
 * Marca todas as notificações como lidas
 */
document.getElementById('markAllRead').addEventListener('click', function(e) {
    e.preventDefault();
    // Implementar marcação como lida
    const badge = document.getElementById('notificationCount');
    badge.style.display = 'none';
    
    const notifications = document.querySelectorAll('.notification-item');
    notifications.forEach(item => {
        item.classList.remove('bg-light');
        const indicator = item.querySelector('.bg-primary.rounded-circle');
        if (indicator) indicator.remove();
    });
});
</script>
