<!-- Componente de Footer Reutilizável -->
<!-- Para incluir: use JavaScript para carregar ou server-side includes -->

<footer class="mt-auto py-4" style="background-color: var(--pli-dark); color: white;">
    <div class="container">
        <div class="row align-items-center">
            <!-- Informações do sistema -->
            <div class="col-md-6 mb-3 mb-md-0">
                <div class="d-flex flex-column">
                    <div class="d-flex align-items-center mb-2">
                        <i class="fas fa-users me-2"></i>
                        <span class="fw-bold">Sistema PLI</span>
                        <small class="ms-2 text-muted">v1.0.0</small>
                    </div>
                    <small class="text-muted">
                        © 2024 Programa de Legalização de Imóveis. Todos os direitos reservados.
                    </small>
                </div>
            </div>

            <!-- Links úteis e informações -->
            <div class="col-md-6">
                <div class="row">
                    <!-- Status do sistema -->
                    <div class="col-sm-6 mb-2">
                        <div class="d-flex align-items-center justify-content-md-center">
                            <span class="status-indicator bg-success rounded-circle me-2" 
                                  style="width: 8px; height: 8px;" 
                                  id="systemStatus"></span>
                            <small class="text-muted">Sistema Online</small>
                        </div>
                    </div>

                    <!-- Informações técnicas -->
                    <div class="col-sm-6">
                        <div class="text-md-end">
                            <small class="text-muted d-block">
                                <i class="fas fa-server me-1"></i>
                                Servidor: <span id="serverStatus">Conectado</span>
                            </small>
                            <small class="text-muted d-block">
                                <i class="fas fa-database me-1"></i>
                                BD: <span id="dbStatus">Online</span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Linha divisória -->
        <hr class="my-3 border-secondary">

        <!-- Informações adicionais -->
        <div class="row align-items-center">
            <div class="col-md-8">
                <div class="d-flex flex-wrap align-items-center">
                    <small class="text-muted me-3">
                        <i class="fas fa-code me-1"></i>
                        Desenvolvido com tecnologias open source
                    </small>
                    <small class="text-muted me-3">
                        <i class="fas fa-shield-alt me-1"></i>
                        Segurança SSL/TLS
                    </small>
                    <small class="text-muted">
                        <i class="fas fa-mobile-alt me-1"></i>
                        Interface responsiva
                    </small>
                </div>
            </div>

            <div class="col-md-4 text-md-end mt-2 mt-md-0">
                <div class="d-flex justify-content-md-end align-items-center">
                    <!-- Links de suporte -->
                    <a href="#" class="text-light me-3" title="Ajuda" onclick="openHelpModal()">
                        <i class="fas fa-question-circle"></i>
                    </a>
                    <a href="#" class="text-light me-3" title="Suporte" onclick="openSupportModal()">
                        <i class="fas fa-life-ring"></i>
                    </a>
                    <a href="#" class="text-light" title="Documentação" onclick="openDocumentation()">
                        <i class="fas fa-book"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Informações de sessão (apenas para usuários logados) -->
        <div class="row mt-3" id="sessionInfo" style="display: none;">
            <div class="col-12">
                <div class="card bg-dark border-secondary">
                    <div class="card-body py-2">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <small class="text-muted">
                                    <i class="fas fa-user me-1"></i>
                                    Usuário: <span id="footerUserName" class="text-light">-</span>
                                </small>
                            </div>
                            <div class="col-md-4">
                                <small class="text-muted">
                                    <i class="fas fa-clock me-1"></i>
                                    Login: <span id="loginTime" class="text-light">-</span>
                                </small>
                            </div>
                            <div class="col-md-4 text-md-end">
                                <small class="text-muted">
                                    <i class="fas fa-timer me-1"></i>
                                    Sessão: <span id="sessionTimer" class="text-light">-</span>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

<script>
/**
 * Inicialização do footer
 */
document.addEventListener('DOMContentLoaded', function() {
    initializeFooter();
    checkSystemStatus();
    updateSessionInfo();
});

/**
 * Inicializa componentes do footer
 */
function initializeFooter() {
    // Verifica se o usuário está logado
    const user = JSON.parse(localStorage.getItem('user') || '{}');
    if (user.nome) {
        document.getElementById('sessionInfo').style.display = 'block';
        startSessionTimer();
    }
}

/**
 * Verifica status do sistema
 */
function checkSystemStatus() {
    // Simulação de verificação de status
    // Em produção, faria chamadas para endpoints de health check
    
    const statusIndicator = document.getElementById('systemStatus');
    const serverStatus = document.getElementById('serverStatus');
    const dbStatus = document.getElementById('dbStatus');
    
    // Simula verificação assíncrona
    setTimeout(() => {
        try {
            // Verificação do servidor
            fetch('/api/health')
                .then(response => {
                    if (response.ok) {
                        statusIndicator.className = 'status-indicator bg-success rounded-circle me-2';
                        serverStatus.textContent = 'Conectado';
                        serverStatus.className = 'text-success';
                    } else {
                        throw new Error('Servidor com problemas');
                    }
                })
                .catch(() => {
                    statusIndicator.className = 'status-indicator bg-warning rounded-circle me-2';
                    serverStatus.textContent = 'Instável';
                    serverStatus.className = 'text-warning';
                });
                
            // Verificação do banco de dados
            fetch('/api/health/database')
                .then(response => {
                    if (response.ok) {
                        dbStatus.textContent = 'Online';
                        dbStatus.className = 'text-success';
                    } else {
                        throw new Error('BD com problemas');
                    }
                })
                .catch(() => {
                    dbStatus.textContent = 'Offline';
                    dbStatus.className = 'text-danger';
                });
                
        } catch (error) {
            statusIndicator.className = 'status-indicator bg-danger rounded-circle me-2';
            serverStatus.textContent = 'Desconectado';
            serverStatus.className = 'text-danger';
        }
    }, 1000);
}

/**
 * Atualiza informações da sessão
 */
function updateSessionInfo() {
    const user = JSON.parse(localStorage.getItem('user') || '{}');
    const loginTime = localStorage.getItem('loginTime');
    
    if (user.nome) {
        document.getElementById('footerUserName').textContent = user.nome;
        
        if (loginTime) {
            const login = new Date(loginTime);
            document.getElementById('loginTime').textContent = login.toLocaleTimeString();
        }
    }
}

/**
 * Inicia timer da sessão
 */
function startSessionTimer() {
    const loginTime = localStorage.getItem('loginTime');
    if (!loginTime) return;
    
    const startTime = new Date(loginTime);
    const timerElement = document.getElementById('sessionTimer');
    
    function updateTimer() {
        const now = new Date();
        const elapsed = now - startTime;
        
        const hours = Math.floor(elapsed / (1000 * 60 * 60));
        const minutes = Math.floor((elapsed % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((elapsed % (1000 * 60)) / 1000);
        
        timerElement.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }
    
    updateTimer();
    setInterval(updateTimer, 1000);
}

/**
 * Abre modal de ajuda
 */
function openHelpModal() {
    // Implementar modal de ajuda
    const helpContent = `
        <div class="modal fade" id="helpModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="fas fa-question-circle me-2"></i>Central de Ajuda
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="accordion" id="helpAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingOne">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                        Como cadastrar uma pessoa física?
                                    </button>
                                </h2>
                                <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#helpAccordion">
                                    <div class="accordion-body">
                                        Acesse o menu "Cadastros" > "Pessoa Física" e preencha todos os campos obrigatórios...
                                    </div>
                                </div>
                            </div>
                            <!-- Mais itens de ajuda -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remove modal existente se houver
    const existingModal = document.getElementById('helpModal');
    if (existingModal) existingModal.remove();
    
    // Adiciona novo modal
    document.body.insertAdjacentHTML('beforeend', helpContent);
    
    // Mostra modal
    const modal = new bootstrap.Modal(document.getElementById('helpModal'));
    modal.show();
}

/**
 * Abre modal de suporte
 */
function openSupportModal() {
    // Implementar modal de suporte
    alert('Funcionalidade de suporte em desenvolvimento.\n\nPara suporte técnico, entre em contato:\nEmail: suporte@pli.gov.br\nTelefone: (11) 1234-5678');
}

/**
 * Abre documentação
 */
function openDocumentation() {
    // Implementar abertura da documentação
    window.open('#', '_blank');
}

/**
 * Verifica status periodicamente
 */
setInterval(checkSystemStatus, 30000); // A cada 30 segundos
</script>

<style>
.status-indicator {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

footer a:hover {
    transform: scale(1.1);
    transition: transform 0.2s ease;
}

#sessionInfo {
    animation: slideIn 0.5s ease-in-out;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
