<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Pessoa Física - PLI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/sistema_aplicacao_cores_pli.css">
    <style>
        .form-section {
            margin-bottom: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        .form-section-header {
            background: var(--pli-azul-escuro);
            color: white;
            padding: 1rem;
            font-weight: 600;
        }
        .form-section-body {
            background: #fff;
            padding: 1.5rem;
        }
        .required-field::after {
            content: " *";
            color: red;
        }
        
        .captcha-container {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            margin-bottom: 30px;
            border: 1px solid #dee2e6;
        }
    </style>
</head>
<body class="d-flex flex-column min-vh-100">
    <!-- Navegação -->
    <div id="navbar-container">
        <!-- O navbar será carregado aqui via JavaScript -->
    </div>
    
    <script>
        // Carrega o navbar compartilhado
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/views/components/navbar.html')
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const navbar = doc.querySelector('#navbar-public');
                    document.getElementById('navbar-container').innerHTML = navbar.outerHTML;
                    
                    // Marca o link atual como ativo
                    const currentPath = window.location.pathname;
                    if (currentPath.includes('cadastro-pessoa-fisica')) {
                        document.querySelector('#navbar-container .nav-link[href="cadastro-pessoa-fisica.html"]').classList.add('active');
                    }
                })
                .catch(error => console.error('Erro ao carregar navbar:', error));
        });
    </script>

    <!-- Área Central -->
    <div class="flex-grow-1 py-5" 
         class="pli-bg-gradient">
        <div class="container pli-main-content">
            <!-- Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="text-center">
                        <h1 class="h3 mb-2">
                            <i class="fas fa-user text-primary"></i> 
                            Cadastro de Pessoa Física
                        </h1>
                        <p class="text-muted">Preencha o formulário abaixo para solicitar seu cadastro no sistema</p>
                    </div>
                </div>
            </div>

            <!-- Formulário -->
            <div class="row justify-content-center">
                <div class="col-12">
                    <form id="pessoaFisicaPublicForm" novalidate>
                        <!-- Dados Pessoais -->
                        <div class="form-section">
                            <div class="form-section-header">
                                <i class="fas fa-id-card me-2"></i> Dados Pessoais
                            </div>
                            <div class="form-section-body">
                                <div class="row g-3">
                                    <div class="col-md-8">
                                        <label for="nomeCompleto" class="form-label required-field">Nome Completo</label>
                                        <input type="text" class="form-control" id="nomeCompleto" name="nome_completo" required>
                                        <div class="invalid-feedback">Por favor, informe seu nome completo.</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="nomeSocial" class="form-label">Nome Social</label>
                                        <input type="text" class="form-control" id="nomeSocial" name="nome_social">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="cpf" class="form-label required-field">CPF</label>
                                        <input type="text" class="form-control" id="cpf" name="cpf" required>
                                        <div class="invalid-feedback">Por favor, informe um CPF válido.</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="dataNascimento" class="form-label required-field">Data de Nascimento</label>
                                        <input type="date" class="form-control" id="dataNascimento" name="data_nascimento" required>
                                        <div class="invalid-feedback">Por favor, informe sua data de nascimento.</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="sexo" class="form-label">Sexo</label>
                                        <select class="form-select" id="sexo" name="sexo">
                                            <option value="">Selecione</option>
                                            <option value="M">Masculino</option>
                                            <option value="F">Feminino</option>
                                            <option value="O">Outro</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="estado_civil" class="form-label">Estado Civil</label>
                                        <select class="form-select" id="estado_civil" name="estado_civil">
                                            <option value="">Selecione</option>
                                            <option value="SOLTEIRO">Solteiro(a)</option>
                                            <option value="CASADO">Casado(a)</option>
                                            <option value="DIVORCIADO">Divorciado(a)</option>
                                            <option value="VIUVO">Viúvo(a)</option>
                                            <option value="UNIAO_ESTAVEL">União Estável</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="nacionalidade" class="form-label">Nacionalidade</label>
                                        <input type="text" class="form-control" id="nacionalidade" name="nacionalidade" value="BRASILEIRA">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="naturalidade" class="form-label">Naturalidade</label>
                                        <input type="text" class="form-control" id="naturalidade" name="naturalidade">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Informações Familiares -->
                        <div class="form-section">
                            <div class="form-section-header">
                                <i class="fas fa-users me-2"></i> Informações Familiares
                            </div>
                            <div class="form-section-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="nomePai" class="form-label">Nome do Pai</label>
                                        <input type="text" class="form-control" id="nomePai" name="nome_pai">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="nomeMae" class="form-label">Nome da Mãe</label>
                                        <input type="text" class="form-control" id="nomeMae" name="nome_mae">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Documentos -->
                        <div class="form-section">
                            <div class="form-section-header">
                                <i class="fas fa-file-alt me-2"></i> Documentos
                            </div>
                            <div class="form-section-body">
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label for="rg" class="form-label">RG</label>
                                        <input type="text" class="form-control" id="rg" name="rg">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="orgaoExpeditor" class="form-label">Órgão Expeditor</label>
                                        <input type="text" class="form-control" id="orgaoExpeditor" name="orgao_expeditor">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="ufRg" class="form-label">UF do RG</label>
                                        <select class="form-select" id="ufRg" name="uf_rg">
                                            <option value="">Selecione</option>
                                            <!-- Estados brasileiros serão carregados via JS -->
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="dataExpedicaoRg" class="form-label">Data de Expedição do RG</label>
                                        <input type="date" class="form-control" id="dataExpedicaoRg" name="data_expedicao_rg">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="tituloEleitor" class="form-label">Título de Eleitor</label>
                                        <input type="text" class="form-control" id="tituloEleitor" name="titulo_eleitor">
                                    </div>
                                    <div class="col-md-2">
                                        <label for="zonaEleitoral" class="form-label">Zona Eleitoral</label>
                                        <input type="text" class="form-control" id="zonaEleitoral" name="zona_eleitoral">
                                    </div>
                                    <div class="col-md-2">
                                        <label for="secaoEleitoral" class="form-label">Seção Eleitoral</label>
                                        <input type="text" class="form-control" id="secaoEleitoral" name="secao_eleitoral">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="pisPasep" class="form-label">PIS/PASEP</label>
                                        <input type="text" class="form-control" id="pisPasep" name="pis_pasep">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Contato -->
                        <div class="form-section">
                            <div class="form-section-header">
                                <i class="fas fa-phone me-2"></i> Contato
                            </div>
                            <div class="form-section-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="email" class="form-label required-field">Email Principal</label>
                                        <input type="email" class="form-control" id="email" name="email" required>
                                        <div class="invalid-feedback">Por favor, informe um email válido.</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="emailSecundario" class="form-label">Email Secundário</label>
                                        <input type="email" class="form-control" id="emailSecundario" name="email_secundario">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="telefonePrincipal" class="form-label required-field">Telefone Principal</label>
                                        <input type="text" class="form-control" id="telefonePrincipal" name="telefone_principal" required>
                                        <div class="invalid-feedback">Por favor, informe um telefone válido.</div>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="telefoneSecundario" class="form-label">Telefone Secundário</label>
                                        <input type="text" class="form-control" id="telefoneSecundario" name="telefone_secundario">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Informações Profissionais -->
                        <div class="form-section">
                            <div class="form-section-header">
                                <i class="fas fa-briefcase me-2"></i> Informações Profissionais
                            </div>
                            <div class="form-section-body">
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label for="profissao" class="form-label">Profissão</label>
                                        <input type="text" class="form-control" id="profissao" name="profissao">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="escolaridade" class="form-label">Escolaridade</label>
                                        <select class="form-select" id="escolaridade" name="escolaridade">
                                            <option value="">Selecione</option>
                                            <option value="FUNDAMENTAL">Ensino Fundamental</option>
                                            <option value="MEDIO">Ensino Médio</option>
                                            <option value="SUPERIOR">Ensino Superior</option>
                                            <option value="POS_GRADUACAO">Pós-graduação</option>
                                            <option value="MESTRADO">Mestrado</option>
                                            <option value="DOUTORADO">Doutorado</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="rendaMensal" class="form-label">Renda Mensal (R$)</label>
                                        <input type="number" step="0.01" min="0" class="form-control" id="rendaMensal" name="renda_mensal">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Endereço -->
                        <div class="form-section">
                            <div class="form-section-header">
                                <i class="fas fa-map-marker-alt me-2"></i> Endereço
                            </div>
                            <div class="form-section-body">
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <label for="cep" class="form-label required-field">CEP</label>
                                        <input type="text" class="form-control" id="cep" name="cep" required>
                                        <div class="invalid-feedback">Por favor, informe um CEP válido.</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="logradouro" class="form-label required-field">Logradouro</label>
                                        <input type="text" class="form-control" id="logradouro" name="logradouro" required>
                                        <div class="invalid-feedback">Por favor, informe o logradouro.</div>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="numero" class="form-label required-field">Número</label>
                                        <input type="text" class="form-control" id="numero" name="numero" required>
                                        <div class="invalid-feedback">Por favor, informe o número.</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="complemento" class="form-label">Complemento</label>
                                        <input type="text" class="form-control" id="complemento" name="complemento">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="bairro" class="form-label required-field">Bairro</label>
                                        <input type="text" class="form-control" id="bairro" name="bairro" required>
                                        <div class="invalid-feedback">Por favor, informe o bairro.</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="cidade" class="form-label required-field">Cidade</label>
                                        <input type="text" class="form-control" id="cidade" name="cidade" required>
                                        <div class="invalid-feedback">Por favor, informe a cidade.</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="uf" class="form-label required-field">UF</label>
                                        <select class="form-select" id="uf" name="uf" required>
                                            <option value="">Selecione</option>
                                            <!-- Estados brasileiros serão carregados via JS -->
                                        </select>
                                        <div class="invalid-feedback">Por favor, selecione um estado.</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="pais" class="form-label">País</label>
                                        <input type="text" class="form-control" id="pais" name="pais" value="Brasil">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Termos e Condições -->
                        <div class="form-section">
                            <div class="form-section-header">
                                <i class="fas fa-file-signature me-2"></i> Termos e Condições
                            </div>
                            <div class="form-section-body">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="termoPrivacidade" name="termo_privacidade" required>
                                    <label class="form-check-label" for="termoPrivacidade">
                                        Li e concordo com a <a href="#" data-bs-toggle="modal" data-bs-target="#privacidadeModal">Política de Privacidade</a> *
                                    </label>
                                    <div class="invalid-feedback">Você deve concordar com a política de privacidade.</div>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="termoUso" name="termo_uso" required>
                                    <label class="form-check-label" for="termoUso">
                                        Li e concordo com os <a href="#" data-bs-toggle="modal" data-bs-target="#termosModal">Termos de Uso</a> *
                                    </label>
                                    <div class="invalid-feedback">Você deve concordar com os termos de uso.</div>
                                </div>
                                
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <small>Seus dados serão utilizados apenas para fins de cadastro no sistema PLI e não serão compartilhados com terceiros.</small>
                                </div>
                            </div>
                        </div>

                        <!-- Botões -->
                        <div class="d-flex justify-content-between mt-4">
                            <button type="button" class="btn btn-secondary btn-lg px-4" onclick="window.location.href='index.html'">
                                <i class="fas fa-arrow-left me-2"></i> Voltar
                            </button>
                            <button type="submit" class="btn btn-primary btn-lg px-4">
                                <i class="fas fa-save me-2"></i> Solicitar Cadastro
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Política de Privacidade -->
    <div class="modal fade" id="privacidadeModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-shield-alt me-2"></i> Política de Privacidade
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <h6>1. Coleta de Dados</h6>
                    <p>Coletamos informações pessoais como nome, CPF, endereço, telefone e email para fins de cadastro no sistema PLI.</p>
                    
                    <h6>2. Uso dos Dados</h6>
                    <p>Seus dados serão utilizados exclusivamente para:</p>
                    <ul>
                        <li>Identificação e autenticação no sistema</li>
                        <li>Comunicação sobre seu cadastro e processos relacionados</li>
                        <li>Cumprimento de obrigações legais</li>
                    </ul>
                    
                    <h6>3. Armazenamento</h6>
                    <p>Seus dados são armazenados em servidores seguros e protegidos por medidas técnicas adequadas.</p>
                    
                    <h6>4. Compartilhamento</h6>
                    <p>Não compartilhamos seus dados com terceiros, exceto quando exigido por lei.</p>
                    
                    <h6>5. Seus Direitos</h6>
                    <p>Você tem direito a acessar, corrigir e solicitar a exclusão dos seus dados, conforme a Lei Geral de Proteção de Dados (LGPD).</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary btn-lg px-4" data-bs-dismiss="modal">>Entendi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Termos de Uso -->
    <div class="modal fade" id="termosModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-file-contract me-2"></i> Termos de Uso
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <h6>1. Aceitação dos Termos</h6>
                    <p>Ao utilizar o Sistema PLI, você concorda com estes termos de uso.</p>
                    
                    <h6>2. Cadastro</h6>
                    <p>Você é responsável por fornecer informações verdadeiras e manter seus dados atualizados.</p>
                    
                    <h6>3. Uso do Sistema</h6>
                    <p>O sistema deve ser utilizado apenas para os fins a que se destina, sendo proibido:</p>
                    <ul>
                        <li>Utilizar dados falsos</li>
                        <li>Tentar acessar áreas restritas sem autorização</li>
                        <li>Realizar ações que possam danificar ou sobrecarregar o sistema</li>
                    </ul>
                    
                    <h6>4. Responsabilidades</h6>
                    <p>Você é responsável por todas as atividades realizadas com seu cadastro.</p>
                    
                    <h6>5. Alterações nos Termos</h6>
                    <p>Estes termos podem ser alterados a qualquer momento, sendo sua responsabilidade verificá-los periodicamente.</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary btn-lg px-4" data-bs-dismiss="modal">>Entendi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Sucesso -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-success">
                        <i class="fas fa-check-circle me-2"></i> Cadastro Solicitado com Sucesso
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <i class="fas fa-check-circle text-success pli-icon-4rem"></i>
                    </div>
                    <p>Sua solicitação de cadastro foi recebida com sucesso!</p>
                    <p>Um email de confirmação foi enviado para o endereço informado. Siga as instruções para concluir seu cadastro.</p>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Seu cadastro será analisado pela nossa equipe e você receberá uma resposta em breve.
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="index.html" class="btn btn-primary btn-lg px-4">
                        <i class="fas fa-home me-2"></i> Ir para Página Inicial
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div id="footer-container">
        <!-- O footer será carregado aqui via JavaScript -->
    </div>
    
    <script>
        // Carrega o footer compartilhado
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/views/components/footer.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('footer-container').innerHTML = html;
                })
                .catch(error => console.error('Erro ao carregar footer:', error));
        });
    </script>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    
    <!-- Scripts da aplicação -->
    <script src="/js/services/api.js"></script>
    <script src="/js/components/form-validator.js"></script>
    <script src="/js/components/anti-bot.js"></script>
    
    <!-- Script de teste (apenas para ambiente de desenvolvimento) -->
    <script src="/js/test-anti-bot.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializa proteção anti-bot
            let antiBotProtection;
            try {
                antiBotProtection = new AntiBotProtection('pessoaFisicaPublicForm');
            } catch (error) {
                console.error('Erro ao inicializar proteção anti-bot:', error);
            }
            
            // Carrega estados brasileiros
            const estados = [
                {sigla: 'AC', nome: 'Acre'},
                {sigla: 'AL', nome: 'Alagoas'},
                {sigla: 'AP', nome: 'Amapá'},
                {sigla: 'AM', nome: 'Amazonas'},
                {sigla: 'BA', nome: 'Bahia'},
                {sigla: 'CE', nome: 'Ceará'},
                {sigla: 'DF', nome: 'Distrito Federal'},
                {sigla: 'ES', nome: 'Espírito Santo'},
                {sigla: 'GO', nome: 'Goiás'},
                {sigla: 'MA', nome: 'Maranhão'},
                {sigla: 'MT', nome: 'Mato Grosso'},
                {sigla: 'MS', nome: 'Mato Grosso do Sul'},
                {sigla: 'MG', nome: 'Minas Gerais'},
                {sigla: 'PA', nome: 'Pará'},
                {sigla: 'PB', nome: 'Paraíba'},
                {sigla: 'PR', nome: 'Paraná'},
                {sigla: 'PE', nome: 'Pernambuco'},
                {sigla: 'PI', nome: 'Piauí'},
                {sigla: 'RJ', nome: 'Rio de Janeiro'},
                {sigla: 'RN', nome: 'Rio Grande do Norte'},
                {sigla: 'RS', nome: 'Rio Grande do Sul'},
                {sigla: 'RO', nome: 'Rondônia'},
                {sigla: 'RR', nome: 'Roraima'},
                {sigla: 'SC', nome: 'Santa Catarina'},
                {sigla: 'SP', nome: 'São Paulo'},
                {sigla: 'SE', nome: 'Sergipe'},
                {sigla: 'TO', nome: 'Tocantins'}
            ];
            
            const selectUf = document.getElementById('uf');
            const selectUfRg = document.getElementById('ufRg');
            
            estados.forEach(estado => {
                const option = document.createElement('option');
                option.value = estado.sigla;
                option.textContent = `${estado.sigla} - ${estado.nome}`;
                
                selectUf.appendChild(option.cloneNode(true));
                selectUfRg.appendChild(option);
            });
            
            // Inicializa máscaras
            setTimeout(function() {
                if (window.jQuery && $.fn.mask) {
                    $('#cpf').mask('000.000.000-00');
                    $('#telefonePrincipal').mask('(00) 00000-0000');
                    $('#telefoneSecundario').mask('(00) 00000-0000');
                    $('#cep').mask('00000-000');
                    $('#tituloEleitor').mask('0000 0000 0000');
                    $('#pisPasep').mask('000.00000.00-0');
                    $('#rendaMensal').mask('#.##0,00', {reverse: true});
                } else {
                    console.error('jQuery ou jQuery Mask não estão disponíveis');
                }
            }, 500);
            
            // Validação do formulário
            const form = document.getElementById('pessoaFisicaPublicForm');
            
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                
                if (!form.checkValidity()) {
                    event.stopPropagation();
                    form.classList.add('was-validated');
                    return;
                }
                
                // Prepara os dados do formulário
                const formData = new FormData(form);
                const formDataObj = {};
                formData.forEach((value, key) => {
                    formDataObj[key] = value;
                });
                
                // Mapear campos do formulário para os campos do banco de dados
                if (formDataObj.email) {
                    formDataObj.email_principal = formDataObj.email;
                }
                if (formDataObj.email_secundario) {
                    formDataObj.email_secundario = formDataObj.email_secundario;
                }
                if (formDataObj.telefone_principal) {
                    formDataObj.telefone_principal = formDataObj.telefone_principal;
                }
                if (formDataObj.telefone_secundario) {
                    formDataObj.telefone_secundario = formDataObj.telefone_secundario;
                }
                if (formDataObj.uf) {
                    formDataObj.estado = formDataObj.uf;
                }
                if (formDataObj.data_expedicao_rg) {
                    formDataObj.rg_data_expedicao = formDataObj.data_expedicao_rg;
                }
                if (formDataObj.orgao_expeditor) {
                    formDataObj.rg_orgao_expedidor = formDataObj.orgao_expeditor;
                }
                
                const submitButton = form.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Enviando...';
                
                // Log para depuração
                console.log('Enviando dados para a API:', formDataObj);
                
                // Envio real para a API
                fetch('/api/pessoa-fisica', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formDataObj)
                })
                .then(response => {
                    console.log('Status da resposta:', response.status);
                    if (!response.ok) {
                        return response.json().then(errorData => {
                            console.error('Erro detalhado:', errorData);
                            throw new Error(errorData.error || 'Erro ao enviar dados');
                        }).catch(err => {
                            throw new Error('Erro ao enviar dados: ' + response.status);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    // Exibe modal de sucesso
                    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                    successModal.show();
                    
                    // Reseta formulário
                    form.reset();
                    form.classList.remove('was-validated');
                    
                    // Atualiza CAPTCHA se existir
                    if (antiBotProtection && typeof antiBotProtection.refreshCaptcha === 'function') {
                        antiBotProtection.refreshCaptcha();
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Erro ao enviar dados',
                        text: 'Ocorreu um erro ao processar sua solicitação. Por favor, tente novamente mais tarde.'
                    });
                })
                .finally(() => {
                    // Restaura botão
                    submitButton.disabled = false;
                    submitButton.innerHTML = '<i class="fas fa-save me-2"></i> Solicitar Cadastro';
                });
            });
            
            // Busca CEP
            const cepInput = document.getElementById('cep');
            cepInput.addEventListener('blur', function() {
                const cep = this.value.replace(/\D/g, '');
                
                if (cep.length !== 8) return;
                
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(response => response.json())
                    .then(data => {
                        if (!data.erro) {
                            document.getElementById('logradouro').value = data.logradouro;
                            document.getElementById('bairro').value = data.bairro;
                            document.getElementById('cidade').value = data.localidade;
                            document.getElementById('uf').value = data.uf;
                        }
                    })
                    .catch(error => console.error('Erro ao buscar CEP:', error));
            });
        });
    </script>
</body>
</html>