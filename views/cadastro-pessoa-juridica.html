<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Pessoa Jurídica - SIGMA-PLI | Módulo de Gerenciamento de Cadastros</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/sistema_aplicacao_cores_pli.css">
    <style>
        .form-section {
            margin-bottom: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        .form-section-header {
            background: var(--pli-azul-escuro);
            color: white;
            padding: 1rem;
            font-weight: 600;
        }
        .form-section-body {
            background: #fff;
            padding: 1.5rem;
        }
        .required-field::after {
            content: " *";
            color: red;
        }
        
        /* Estilos para Toast */
        .custom-toast {
            background: white;
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 10px;
            overflow: hidden;
        }
        
        .toast-header {
            border-bottom: none;
            padding: 1rem 1rem 0.5rem;
        }
        
        .toast-body {
            padding: 0.5rem 1rem 1rem;
        }
        
        .toast-success .toast-header {
            color: #198754;
        }
        
        .toast-error .toast-header {
            color: #dc3545;
        }
        
        .toast-info .toast-header {
            color: var(--pli-azul-escuro);
        }
        
        /* Garantir que o footer apareça */
        #footer-container {
            margin-top: auto;
            padding-top: 2rem;
        }
    </style>
</head>
<body class="d-flex flex-column min-vh-100">
    <div id="navbar-container"></div>
    <script src="/static/js/navbar-loader.js"></script>

 
    <!-- Área Central -->
    <div class="flex-grow-1 py-5" 
         class="pli-bg-gradient">
        <div class="container pli-main-content">
            <!-- Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="text-center">
                        <h1 class="h3 mb-2">
                            <i class="fas fa-building text-primary"></i> 
                            Cadastro de Pessoa Jurídica
                        </h1>
                        <p class="text-muted">Preencha o formulário abaixo para solicitar o cadastro da sua empresa no sistema</p>
                    </div>
                </div>
            </div>

            <!-- Formulário -->
            <div class="row justify-content-center">
                <div class="col-12">
                    <form id="pessoaJuridicaPublicForm" novalidate>
                        <!-- Dados da Empresa -->
                        <div class="form-section">
                            <div class="form-section-header">
                                <i class="fas fa-building me-2"></i> Dados da Empresa
                            </div>
                            <div class="form-section-body">
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label for="cnpj" class="form-label required-field">CNPJ</label>
                                        <input type="text" class="form-control" id="cnpj" name="cnpj" required>
                                        <div class="invalid-feedback">Por favor, informe um CNPJ válido.</div>
                                    </div>
                                    <div class="col-md-8">
                                        <label for="razaoSocial" class="form-label required-field">Razão Social</label>
                                        <input type="text" class="form-control" id="razaoSocial" name="razao_social" required>
                                        <div class="invalid-feedback">Por favor, informe a razão social.</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="nomeFantasia" class="form-label">Nome Fantasia</label>
                                        <input type="text" class="form-control" id="nomeFantasia" name="nome_fantasia">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="porteEmpresa" class="form-label">Porte da Empresa</label>
                                        <select class="form-select" id="porteEmpresa" name="porte_empresa">
                                            <option value="">Selecione</option>
                                            <option value="MEI">MEI</option>
                                            <option value="ME">Microempresa</option>
                                            <option value="EPP">Empresa de Pequeno Porte</option>
                                            <option value="MEDIO">Empresa de Médio Porte</option>
                                            <option value="GRANDE">Empresa de Grande Porte</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="dataAbertura" class="form-label">Data de Abertura</label>
                                        <input type="date" class="form-control" id="dataAbertura" name="data_abertura">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="inscricaoEstadual" class="form-label">Inscrição Estadual</label>
                                        <input type="text" class="form-control" id="inscricaoEstadual" name="inscricao_estadual">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="inscricaoMunicipal" class="form-label">Inscrição Municipal</label>
                                        <input type="text" class="form-control" id="inscricaoMunicipal" name="inscricao_municipal">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="situacaoReceita" class="form-label">Situação na Receita Federal</label>
                                        <select class="form-select" id="situacaoReceita" name="situacao_receita_federal">
                                            <option value="">Selecione</option>
                                            <option value="ATIVA" selected>Ativa</option>
                                            <option value="SUSPENSA">Suspensa</option>
                                            <option value="INAPTA">Inapta</option>
                                            <option value="BAIXADA">Baixada</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="naturezaJuridica" class="form-label">Natureza Jurídica</label>
                                        <input type="text" class="form-control" id="naturezaJuridica" name="natureza_juridica">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="regimeTributario" class="form-label">Regime Tributário</label>
                                        <select class="form-select" id="regimeTributario" name="regime_tributario">
                                            <option value="">Selecione</option>
                                            <option value="SIMPLES">Simples Nacional</option>
                                            <option value="LUCRO_PRESUMIDO">Lucro Presumido</option>
                                            <option value="LUCRO_REAL">Lucro Real</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Contato -->
                        <div class="form-section">
                            <div class="form-section-header">
                                <i class="fas fa-phone me-2"></i> Informações de Contato
                            </div>
                            <div class="form-section-body">
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label for="email" class="form-label required-field">Email Principal</label>
                                        <input type="email" class="form-control" id="email" name="email" required>
                                        <div class="invalid-feedback">Por favor, informe um email válido.</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="emailSecundario" class="form-label">Email Secundário</label>
                                        <input type="email" class="form-control" id="emailSecundario" name="email_secundario">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="telefone" class="form-label required-field">Telefone Principal</label>
                                        <input type="text" class="form-control" id="telefone" name="telefone" required>
                                        <div class="invalid-feedback">Por favor, informe um telefone válido.</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="telefoneSecundario" class="form-label">Telefone Secundário</label>
                                        <input type="text" class="form-control" id="telefoneSecundario" name="telefone_secundario">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="site" class="form-label">Website</label>
                                        <input type="url" class="form-control" id="site" name="site" placeholder="https://www.exemplo.com">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Endereço -->
                        <div class="form-section">
                            <div class="form-section-header">
                                <i class="fas fa-map-marker-alt me-2"></i> Endereço
                            </div>
                            <div class="form-section-body">
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <label for="cep" class="form-label required-field">CEP</label>
                                        <input type="text" class="form-control" id="cep" name="cep" required>
                                        <div class="invalid-feedback">Por favor, informe um CEP válido.</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="logradouro" class="form-label required-field">Logradouro</label>
                                        <input type="text" class="form-control" id="logradouro" name="logradouro" required>
                                        <div class="invalid-feedback">Por favor, informe o logradouro.</div>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="numero" class="form-label required-field">Número</label>
                                        <input type="text" class="form-control" id="numero" name="numero" required>
                                        <div class="invalid-feedback">Por favor, informe o número.</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="complemento" class="form-label">Complemento</label>
                                        <input type="text" class="form-control" id="complemento" name="complemento">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="bairro" class="form-label required-field">Bairro</label>
                                        <input type="text" class="form-control" id="bairro" name="bairro" required>
                                        <div class="invalid-feedback">Por favor, informe o bairro.</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="cidade" class="form-label required-field">Cidade</label>
                                        <input type="text" class="form-control" id="cidade" name="cidade" required>
                                        <div class="invalid-feedback">Por favor, informe a cidade.</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="uf" class="form-label required-field">UF</label>
                                        <select class="form-select" id="uf" name="uf" required>
                                            <option value="">Selecione</option>
                                            <!-- Estados brasileiros serão carregados via JS -->
                                        </select>
                                        <div class="invalid-feedback">Por favor, selecione um estado.</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="pais" class="form-label">País</label>
                                        <input type="text" class="form-control" id="pais" name="pais" value="Brasil">
                                    </div>
                                </div>
                            </div>
                        </div>



                        <!-- Termos e Condições -->
                        <div class="form-section">
                            <div class="form-section-header">
                                <i class="fas fa-file-signature me-2"></i> Termos e Condições
                            </div>
                            <div class="form-section-body">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="termoPrivacidade" name="termo_privacidade" required>
                                    <label class="form-check-label" for="termoPrivacidade">
                                        Li e concordo com a <a href="#" data-bs-toggle="modal" data-bs-target="#privacidadeModal">Política de Privacidade</a> *
                                    </label>
                                    <div class="invalid-feedback">Você deve concordar com a política de privacidade.</div>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="termoUso" name="termo_uso" required>
                                    <label class="form-check-label" for="termoUso">
                                        Li e concordo com os <a href="#" data-bs-toggle="modal" data-bs-target="#termosModal">Termos de Uso</a> *
                                    </label>
                                    <div class="invalid-feedback">Você deve concordar com os termos de uso.</div>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="declaracaoVeracidade" name="declaracao_veracidade" required>
                                    <label class="form-check-label" for="declaracaoVeracidade">
                                        Declaro que as informações fornecidas são verdadeiras e estou ciente das responsabilidades legais *
                                    </label>
                                    <div class="invalid-feedback">Você deve concordar com esta declaração.</div>
                                </div>
                                
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <small>Os dados da empresa serão utilizados apenas para fins de cadastro no sistema PLI e não serão compartilhados com terceiros.</small>
                                </div>
                            </div>
                        </div>

                        <!-- Verificação de Segurança -->
                        <div class="form-section">
                            <div class="form-section-header">
                                <i class="fas fa-shield-alt me-2"></i> Verificação de Segurança
                            </div>
                            <div class="form-section-body text-center">
                                <div id="protection-container">
                                    <!-- Verificação de Segurança será inserida automaticamente aqui pelo AntiBotProtection -->
                                </div>
                            </div>
                        </div>

                        <!-- Finalização do Cadastro -->
                        <div class="form-section">
                            <div class="form-section-header">
                                <i class="fas fa-paper-plane me-2"></i> Finalizar Cadastro
                            </div>
                            <div class="form-section-body">
                                <div class="d-flex gap-3">
                                    <button type="button" class="btn btn-light btn-lg flex-fill border-2" onclick="window.location.href='index.html'">
                                        <i class="fas fa-home me-2"></i> Voltar ao Início
                                    </button>
                                    <button type="submit" class="btn btn-primary btn-lg flex-fill">
                                        <i class="fas fa-paper-plane me-2"></i> Enviar Cadastro
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Política de Privacidade -->
    <div class="modal fade" id="privacidadeModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-shield-alt me-2"></i> Política de Privacidade
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <h6>1. Coleta de Dados</h6>
                    <p>Coletamos informações da empresa como CNPJ, razão social, endereço, telefone e email para fins de cadastro no sistema PLI.</p>
                    
                    <h6>2. Uso dos Dados</h6>
                    <p>Os dados serão utilizados exclusivamente para:</p>
                    <ul>
                        <li>Identificação e autenticação no sistema</li>
                        <li>Comunicação sobre o cadastro e processos relacionados</li>
                        <li>Cumprimento de obrigações legais</li>
                    </ul>
                    
                    <h6>3. Armazenamento</h6>
                    <p>Os dados são armazenados em servidores seguros e protegidos por medidas técnicas adequadas.</p>
                    
                    <h6>4. Compartilhamento</h6>
                    <p>Não compartilhamos os dados com terceiros, exceto quando exigido por lei.</p>
                    
                    <h6>5. Seus Direitos</h6>
                    <p>A empresa tem direito a acessar, corrigir e solicitar a exclusão dos seus dados, conforme a Lei Geral de Proteção de Dados (LGPD).</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary btn-lg px-4" data-bs-dismiss="modal">>Entendi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Termos de Uso -->
    <div class="modal fade" id="termosModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-file-contract me-2"></i> Termos de Uso
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <h6>1. Aceitação dos Termos</h6>
                    <p>Ao utilizar o Sistema PLI, a empresa concorda com estes termos de uso.</p>
                    
                    <h6>2. Cadastro</h6>
                    <p>A empresa é responsável por fornecer informações verdadeiras e manter seus dados atualizados.</p>
                    
                    <h6>3. Uso do Sistema</h6>
                    <p>O sistema deve ser utilizado apenas para os fins a que se destina, sendo proibido:</p>
                    <ul>
                        <li>Utilizar dados falsos</li>
                        <li>Tentar acessar áreas restritas sem autorização</li>
                        <li>Realizar ações que possam danificar ou sobrecarregar o sistema</li>
                    </ul>
                    
                    <h6>4. Responsabilidades</h6>
                    <p>A empresa é responsável por todas as atividades realizadas com seu cadastro.</p>
                    
                    <h6>5. Alterações nos Termos</h6>
                    <p>Estes termos podem ser alterados a qualquer momento, sendo responsabilidade da empresa verificá-los periodicamente.</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary btn-lg px-4" data-bs-dismiss="modal">>Entendi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Sucesso -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-success">
                        <i class="fas fa-check-circle me-2"></i> Cadastro Solicitado com Sucesso
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <i class="fas fa-check-circle text-success pli-icon-4rem"></i>
                    </div>
                    <p>A solicitação de cadastro da sua empresa foi recebida com sucesso!</p>
                    <p>Um email de confirmação foi enviado para o endereço informado. Siga as instruções para concluir o cadastro.</p>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        O cadastro será analisado pela nossa equipe e você receberá uma resposta em breve.
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="index.html" class="btn btn-primary btn-lg px-4">
                        <i class="fas fa-home me-2"></i> Ir para Página Inicial
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div id="footer-container">
        <!-- O footer será carregado aqui via JavaScript -->
    </div>
    
    <script>
        // Carrega o footer compartilhado
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/components/footer.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('footer-container').innerHTML = html;
                })
                .catch(error => console.error('Erro ao carregar footer:', error));
        });
    </script>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    
    <!-- Scripts da aplicação -->
    <script src="/static/js/services/api.js"></script>
    <script src="/static/js/components/form-validator.js"></script>
    <script src="/static/js/components/anti-bot.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Container para toasts
            const toastContainer = document.getElementById('toastContainer');
            
            // Função para exibir toast
            function showToast(message, type = 'info', duration = 5000) {
                const toastId = 'toast-' + Date.now();
                const iconClass = type === 'success' ? 'fa-check-circle' : 
                                type === 'error' ? 'fa-exclamation-triangle' : 'fa-info-circle';
                
                const toastHtml = `
                    <div class="toast custom-toast toast-${type}" id="${toastId}" role="alert">
                        <div class="toast-header">
                            <i class="fas ${iconClass} me-2"></i>
                            <strong class="me-auto">${type === 'success' ? 'Sucesso' : type === 'error' ? 'Erro' : 'Informação'}</strong>
                            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                        </div>
                        <div class="toast-body">
                            ${message}
                        </div>
                    </div>
                `;
                
                toastContainer.insertAdjacentHTML('afterbegin', toastHtml);
                const toastElement = document.getElementById(toastId);
                const toast = new bootstrap.Toast(toastElement, { delay: duration });
                toast.show();
                
                // Remove element after hiding
                toastElement.addEventListener('hidden.bs.toast', () => {
                    toastElement.remove();
                });
            }
            
            // Inicializa proteção anti-bot
            let antiBotProtection;
            try {
                antiBotProtection = new AntiBotProtection('pessoaJuridicaPublicForm');
                console.log('Proteção anti-bot inicializada com sucesso');
                showToast('Sistema de proteção anti-bot inicializado', 'success', 3000);
            } catch (error) {
                console.error('Erro ao inicializar proteção anti-bot:', error);
                showToast('Erro ao inicializar proteção anti-bot: ' + error.message, 'error');
            }
            
            // Carrega estados brasileiros
            const estados = [
                {sigla: 'AC', nome: 'Acre'},
                {sigla: 'AL', nome: 'Alagoas'},
                {sigla: 'AP', nome: 'Amapá'},
                {sigla: 'AM', nome: 'Amazonas'},
                {sigla: 'BA', nome: 'Bahia'},
                {sigla: 'CE', nome: 'Ceará'},
                {sigla: 'DF', nome: 'Distrito Federal'},
                {sigla: 'ES', nome: 'Espírito Santo'},
                {sigla: 'GO', nome: 'Goiás'},
                {sigla: 'MA', nome: 'Maranhão'},
                {sigla: 'MT', nome: 'Mato Grosso'},
                {sigla: 'MS', nome: 'Mato Grosso do Sul'},
                {sigla: 'MG', nome: 'Minas Gerais'},
                {sigla: 'PA', nome: 'Pará'},
                {sigla: 'PB', nome: 'Paraíba'},
                {sigla: 'PR', nome: 'Paraná'},
                {sigla: 'PE', nome: 'Pernambuco'},
                {sigla: 'PI', nome: 'Piauí'},
                {sigla: 'RJ', nome: 'Rio de Janeiro'},
                {sigla: 'RN', nome: 'Rio Grande do Norte'},
                {sigla: 'RS', nome: 'Rio Grande do Sul'},
                {sigla: 'RO', nome: 'Rondônia'},
                {sigla: 'RR', nome: 'Roraima'},
                {sigla: 'SC', nome: 'Santa Catarina'},
                {sigla: 'SP', nome: 'São Paulo'},
                {sigla: 'SE', nome: 'Sergipe'},
                {sigla: 'TO', nome: 'Tocantins'}
            ];
            
            const selectUf = document.getElementById('uf');
            
            estados.forEach(estado => {
                const option = document.createElement('option');
                option.value = estado.sigla;
                option.textContent = `${estado.sigla} - ${estado.nome}`;
                
                selectUf.appendChild(option);
            });
            
            // Inicializa máscaras e formatação padronizada COMPLETA
            setTimeout(function() {
                if (window.jQuery && $.fn.mask) {
                    console.log('Aplicando máscaras de formatação padronizada COMPLETA para pessoa jurídica...');
                    
                    // === DOCUMENTOS EMPRESARIAIS ===
                    $('#cnpj').mask('00.000.000/0000-00', {
                        placeholder: '00.000.000/0000-00',
                        translation: {
                            '0': {pattern: /[0-9]/}
                        }
                    });
                    
                    $('#inscricaoEstadual').mask('000.000.000.000', {
                        placeholder: '000.000.000.000'
                    });
                    
                    $('#inscricaoMunicipal').mask('00000000', {
                        placeholder: '00000000'
                    });
                    
                    // === TELEFONES ===
                    $('#telefone').mask('(00) 00000-0000', {
                        placeholder: '(00) 00000-0000',
                        translation: {
                            '0': {pattern: /[0-9]/}
                        }
                    });
                    
                    $('#telefoneSecundario').mask('(00) 00000-0000', {
                        placeholder: '(00) 00000-0000',
                        translation: {
                            '0': {pattern: /[0-9]/}
                        }
                    });
                    
                    // === ENDEREÇO ===
                    $('#cep').mask('00000-000', {
                        placeholder: '00000-000',
                        translation: {
                            '0': {pattern: /[0-9]/}
                        }
                    });
                    
                    $('#numero').mask('000000', {
                        reverse: false,
                        placeholder: ''
                    });
                    
                    // === FORMATAÇÃO DE VALORES MONETÁRIOS ===
                    $('#capitalSocial, #faturamentoAnual, #valor, #valorContrato, #valorDeclarado').mask('#.##0,00', {
                        reverse: true,
                        placeholder: '0,00'
                    });
                    
                    // === FORMATAÇÃO DE TEXTOS EMPRESARIAIS ===
                    function formatarTextoCapitalizado(selector) {
                        $(selector).on('blur', function() {
                            let valor = $(this).val();
                            if (valor) {
                                // Capitaliza primeira letra de cada palavra, exceto preposições
                                let preposicoes = ['de', 'da', 'do', 'das', 'dos', 'e', 'em', 'na', 'no', 'para', 'por', 'com', 'a', 'o', 'as', 'os', 'ltda', 'me', 'epp', 'eireli'];
                                valor = valor.toLowerCase().replace(/\b\w+/g, function(palavra, index) {
                                    if (index > 0 && preposicoes.includes(palavra.toLowerCase())) {
                                        return palavra;
                                    }
                                    return palavra.charAt(0).toUpperCase() + palavra.slice(1);
                                });
                                $(this).val(valor);
                            }
                        });
                    }
                    
                    // Aplicar formatação de texto para nomes e endereços
                    formatarTextoCapitalizado('#razaoSocial, #nomeFantasia, #responsavel, #representanteLegal, #logradouro, #complemento, #bairro, #cidade, #contato, #nomeContato');
                    
                    // === FORMATAÇÃO ESPECÍFICA PARA EMAILS ===
                    $('#email, #emailContato, #emailComercial, #emailResponsavel').on('blur', function() {
                        let email = $(this).val();
                        if (email) {
                            // Converte para minúsculo
                            $(this).val(email.toLowerCase());
                            
                            // Validação básica de email
                            let emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                            if (!emailPattern.test(email)) {
                                $(this).addClass('is-invalid');
                                showToast('Email inválido. Verifique o formato.', 'error');
                            } else {
                                $(this).removeClass('is-invalid').addClass('is-valid');
                            }
                        }
                    });
                    
                    // === FORMATAÇÃO PARA CAMPOS ESPECÍFICOS ===
                    
                    // Natureza Jurídica sempre capitalizada
                    $('#naturezaJuridica').on('blur', function() {
                        let valor = $(this).val();
                        if (valor) {
                            $(this).val(valor.toUpperCase());
                        }
                    });
                    
                    // País sempre capitalizado
                    $('#pais').on('blur', function() {
                        let valor = $(this).val();
                        if (valor) {
                            valor = valor.toLowerCase().replace(/\b\w/g, l => l.toUpperCase());
                            $(this).val(valor);
                        }
                    });
                    
                    // === FORMATAÇÃO PARA CAMPOS DE OBSERVAÇÕES E DESCRIÇÕES ===
                    $('#observacoes, #descricao, #atividade, #atividadeEconomica, #objetoSocial').on('input', function() {
                        let valor = $(this).val();
                        if (valor.length > 500) {
                            $(this).val(valor.substring(0, 500));
                            showToast('Limite de 500 caracteres atingido.', 'info');
                        }
                    });
                    
                    // === VALIDAÇÃO EM TEMPO REAL ===
                    
                    // CNPJ validation
                    $('#cnpj').on('blur', function() {
                        let cnpj = $(this).val().replace(/\D/g, '');
                        if (cnpj.length === 14) {
                            if (!validarCNPJ(cnpj)) {
                                $(this).addClass('is-invalid');
                                showToast('CNPJ inválido. Verifique os números digitados.', 'error');
                            } else {
                                $(this).removeClass('is-invalid').addClass('is-valid');
                            }
                        }
                    });
                    
                    // CEP auto-complete
                    $('#cep').on('blur', function() {
                        let cep = $(this).val().replace(/\D/g, '');
                        if (cep.length === 8) {
                            consultarCEP(cep);
                        }
                    });
                    
                    // Data de Fundação (não pode ser futura)
                    $('#dataFundacao, #dataConstituicao').on('blur', function() {
                        let dataInformada = new Date($(this).val());
                        let hoje = new Date();
                        
                        if (dataInformada > hoje) {
                            $(this).addClass('is-invalid');
                            showToast('Data não pode ser futura.', 'error');
                        } else {
                            $(this).removeClass('is-invalid').addClass('is-valid');
                        }
                    });
                    
                    // Limites de caracteres para campos de texto
                    $('#razaoSocial').attr('maxlength', 150);
                    $('#nomeFantasia').attr('maxlength', 150);
                    $('#naturezaJuridica').attr('maxlength', 100);
                    $('#logradouro').attr('maxlength', 150);
                    $('#complemento').attr('maxlength', 50);
                    $('#bairro').attr('maxlength', 50);
                    $('#cidade').attr('maxlength', 50);
                    $('#pais').attr('maxlength', 50);
                    
                    console.log('Máscaras e formatações COMPLETAS para pessoa jurídica aplicadas com sucesso!');
                } else {
                    console.error('jQuery ou jQuery Mask não estão disponíveis');
                }
            }, 500);
            
            // === FUNÇÕES DE VALIDAÇÃO ===
            function validarCNPJ(cnpj) {
                if (cnpj.length !== 14) return false;
                
                // Elimina CNPJs conhecidos como inválidos
                if (/^(\d)\1+$/.test(cnpj)) return false;
                
                // Valida DVs
                let tamanho = cnpj.length - 2;
                let numeros = cnpj.substring(0, tamanho);
                let digitos = cnpj.substring(tamanho);
                let soma = 0;
                let pos = tamanho - 7;
                
                for (let i = tamanho; i >= 1; i--) {
                    soma += numeros.charAt(tamanho - i) * pos--;
                    if (pos < 2) pos = 9;
                }
                
                let resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
                if (resultado != digitos.charAt(0)) return false;
                
                tamanho = tamanho + 1;
                numeros = cnpj.substring(0, tamanho);
                soma = 0;
                pos = tamanho - 7;
                
                for (let i = tamanho; i >= 1; i--) {
                    soma += numeros.charAt(tamanho - i) * pos--;
                    if (pos < 2) pos = 9;
                }
                
                resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
                return resultado == digitos.charAt(1);
            }
            
            function consultarCEP(cep) {
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(response => response.json())
                    .then(data => {
                        if (!data.erro) {
                            $('#endereco').val(data.logradouro || '');
                            $('#bairro').val(data.bairro || '');
                            $('#cidade').val(data.localidade || '');
                            $('#uf').val(data.uf || '');
                            
                            // Aplicar formatação de texto nos campos preenchidos
                            $('#endereco, #bairro, #cidade').trigger('blur');
                            
                            showToast('Endereço preenchido automaticamente!', 'success');
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao consultar CEP:', error);
                    });
            }
            
            // Validação do formulário
            const form = document.getElementById('pessoaJuridicaPublicForm');
            
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                
                if (!form.checkValidity()) {
                    event.stopPropagation();
                    form.classList.add('was-validated');
                    return;
                }
                
                // Prepara os dados do formulário
                const formData = new FormData(form);
                const formDataObj = {};
                formData.forEach((value, key) => {
                    formDataObj[key] = value;
                });
                
                // Mapear campos do formulário para os campos do banco de dados
                if (formDataObj.email) {
                    formDataObj.email_principal = formDataObj.email;
                }
                if (formDataObj.telefone) {
                    formDataObj.telefone_principal = formDataObj.telefone;
                }
                if (formDataObj.uf) {
                    formDataObj.estado = formDataObj.uf;
                }
                
                const submitButton = form.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Enviando...';
                
                // Log para depuração
                console.log('Enviando dados para a API:', formDataObj);
                
                // Envio real para a API
                fetch('/api/pessoa-juridica', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formDataObj)
                })
                .then(response => {
                    console.log('Status da resposta:', response.status);
                    if (!response.ok) {
                        return response.json().then(errorData => {
                            console.error('Erro detalhado:', errorData);
                            throw new Error(errorData.error || 'Erro ao enviar dados');
                        }).catch(err => {
                            throw new Error('Erro ao enviar dados: ' + response.status);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    // Exibe modal de sucesso
                    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                    successModal.show();
                    
                    // Reseta formulário
                    form.reset();
                    form.classList.remove('was-validated');
                    
                    // Atualiza CAPTCHA se existir
                    if (antiBotProtection && typeof antiBotProtection.refreshCaptcha === 'function') {
                        antiBotProtection.refreshCaptcha();
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Erro ao enviar dados',
                        text: 'Ocorreu um erro ao processar sua solicitação. Por favor, tente novamente mais tarde.'
                    });
                })
                .finally(() => {
                    // Restaura botão
                    submitButton.disabled = false;
                    submitButton.innerHTML = '<i class="fas fa-save me-2"></i> Solicitar Cadastro';
                });
            });
            
            // Busca CEP
            const cepInput = document.getElementById('cep');
            cepInput.addEventListener('blur', function() {
                const cep = this.value.replace(/\D/g, '');
                
                if (cep.length !== 8) return;
                
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(response => response.json())
                    .then(data => {
                        if (!data.erro) {
                            document.getElementById('logradouro').value = data.logradouro;
                            document.getElementById('bairro').value = data.bairro;
                            document.getElementById('cidade').value = data.localidade;
                            document.getElementById('uf').value = data.uf;
                        }
                    })
                    .catch(error => console.error('Erro ao buscar CEP:', error));
            });
            
            // Consulta CNPJ
            const cnpjInput = document.getElementById('cnpj');
            cnpjInput.addEventListener('blur', function() {
                const cnpj = this.value.replace(/\D/g, '');
                if (cnpj.length !== 14) return;

                Swal.fire({
                    icon: 'info',
                    title: 'Consultando CNPJ...',
                    showConfirmButton: false,
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                fetch(`https://brasilapi.com.br/api/cnpj/v1/${cnpj}`)
                    .then(response => response.json())
                    .then(data => {
                        Swal.close();
                        if (data && !data.message) {
                            // Preencher campos do formulário
                            if (data.razao_social) document.getElementById('razaoSocial').value = data.razao_social;
                            if (data.nome_fantasia) document.getElementById('nomeFantasia').value = data.nome_fantasia;
                            if (data.data_abertura) document.getElementById('dataAbertura').value = data.data_abertura;
                            if (data.natureza_juridica) document.getElementById('naturezaJuridica').value = data.natureza_juridica;
                            if (data.cep) document.getElementById('cep').value = data.cep.replace(/(\d{5})(\d{3})/, '$1-$2');
                            if (data.logradouro) document.getElementById('logradouro').value = data.logradouro;
                            if (data.numero) document.getElementById('numero').value = data.numero;
                            if (data.complemento) document.getElementById('complemento').value = data.complemento;
                            if (data.bairro) document.getElementById('bairro').value = data.bairro;
                            if (data.municipio) document.getElementById('cidade').value = data.municipio;
                            if (data.uf) document.getElementById('uf').value = data.uf;
                            if (data.email) document.getElementById('email').value = data.email;
                            if (data.telefone) document.getElementById('telefone').value = data.telefone;
                            if (data.inscricao_estadual) document.getElementById('inscricaoEstadual').value = data.inscricao_estadual;
                            if (data.inscricao_municipal) document.getElementById('inscricaoMunicipal').value = data.inscricao_municipal;
                        } else {
                            Swal.fire({
                                icon: 'warning',
                                title: 'CNPJ não encontrado',
                                text: 'Não foi possível localizar os dados para este CNPJ.'
                            });
                        }
                    })
                    .catch(error => {
                        Swal.close();
                        Swal.fire({
                            icon: 'error',
                            title: 'Erro ao consultar CNPJ',
                            text: 'Não foi possível consultar os dados do CNPJ. Tente novamente mais tarde.'
                        });
                        console.error('Erro ao consultar CNPJ:', error);
                    });
            });
        });
    </script>

    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3" id="toastContainer"></div>

    <!-- Footer Oficial -->
    <div id="footer-container"></div>
    <script src="/static/js/footer-loader.js"></script>
</body>
</html>