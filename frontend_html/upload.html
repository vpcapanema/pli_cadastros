<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload de Documentos - SIGATA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="sistema_aplicacao_cores_pli.css">
</head>
<body>
    <!-- Navegação -->
    <nav class="navbar navbar-expand-lg pli-navbar">
        <div class="container">
            <a class="navbar-brand pli-navbar-brand" href="index.html">
                <i class="fas fa-file-alt"></i> SIGATA
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-label="Alternar navegação" title="Menu de navegação">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="fas fa-home"></i> Início
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="login.html">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="upload.html">
                            <i class="fas fa-upload"></i> Upload
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="documents.html">
                            <i class="fas fa-folder"></i> Documentos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="reports.html">
                            <i class="fas fa-chart-line"></i> Relatórios
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="analytics.html">
                            <i class="fas fa-chart-bar"></i> Analytics
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Header da Página -->
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="d-flex align-items-center justify-content-between mb-4">
                    <div>
                        <h1 class="h2 mb-1">
                            <i class="fas fa-upload text-pli-primary me-2"></i>
                            Upload de Documentos
                        </h1>
                        <p class="text-muted mb-0">Faça upload de atas de reuniões para processamento automático</p>
                    </div>
                    <div>
                        <a href="documents.html" class="btn btn-outline-primary">
                            <i class="fas fa-folder me-2"></i>Ver Documentos
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Área de Upload -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <!-- Upload Card -->
                <div class="pli-card mb-4">
                    <div class="pli-card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-cloud-upload-alt me-2"></i>
                            Área de Upload
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <!-- Dropzone -->
                        <div class="upload-dropzone" id="dropzone">
                            <div class="upload-content text-center">
                                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                <h4 class="mt-3 mb-2">Arraste e solte seus arquivos aqui</h4>
                                <p class="text-muted mb-3">ou clique para selecionar arquivos</p>
                                <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.txt" hidden>
                                <button type="button" class="btn btn-pli-primary" onclick="document.getElementById('fileInput').click()">
                                    <i class="fas fa-plus me-2"></i>Selecionar Arquivos
                                </button>
                                <div class="mt-3">
                                    <small class="text-muted">
                                        Formatos aceitos: PDF, DOC, DOCX, TXT • Tamanho máximo: 10MB por arquivo
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- Lista de Arquivos -->
                        <div id="fileList" class="file-list mt-4">
                            <h6><i class="fas fa-list me-2"></i>Arquivos Selecionados</h6>
                            <div id="selectedFiles"></div>
                            <div class="d-flex justify-content-between mt-3">
                                <button type="button" class="btn btn-outline-secondary" onclick="clearFiles()">
                                    <i class="fas fa-trash me-2"></i>Limpar Tudo
                                </button>
                                <button type="button" class="btn btn-pli-primary" onclick="uploadFiles()">
                                    <i class="fas fa-upload me-2"></i>Fazer Upload
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Progresso de Upload -->
                <div id="uploadProgress" class="pli-card upload-progress mb-4">
                    <div class="pli-card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-spinner fa-spin me-2"></i>
                            Processando Upload
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="progress mb-3">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" id="progressBar" aria-label="Progresso do upload"></div>
                        </div>
                        <div id="progressText" class="text-center">
                            <small class="text-muted">Iniciando upload...</small>
                        </div>
                    </div>
                </div>

                <!-- Instruções -->
                <div class="pli-card">
                    <div class="pli-card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-info-circle me-2"></i>
                            Instruções e Dicas
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6><i class="fas fa-check-circle text-success me-2"></i>Formatos Aceitos</h6>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-file-pdf text-danger me-2"></i>PDF (.pdf)</li>
                                    <li><i class="fas fa-file-word text-primary me-2"></i>Word (.doc, .docx)</li>
                                    <li><i class="fas fa-file-alt text-secondary me-2"></i>Texto (.txt)</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="fas fa-lightbulb text-warning me-2"></i>Dicas</h6>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-arrow-right text-muted me-2"></i>Máximo 10MB por arquivo</li>
                                    <li><i class="fas fa-arrow-right text-muted me-2"></i>Múltiplos arquivos permitidos</li>
                                    <li><i class="fas fa-arrow-right text-muted me-2"></i>Processamento automático</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="pli-footer py-4 mt-5">
        <div class="container text-center">
            <span class="text-white">SIGATA &copy; 2025 - Sistema Integrado de Gestão de Atas</span>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let selectedFiles = [];

        // Configurar dropzone
        const dropzone = document.getElementById('dropzone');
        const fileInput = document.getElementById('fileInput');

        // Eventos de drag and drop
        dropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropzone.classList.add('dragover');
        });

        dropzone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropzone.classList.remove('dragover');
        });

        dropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropzone.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            handleFiles(files);
        });

        // Evento de seleção de arquivos
        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            handleFiles(files);
        });

        // Click no dropzone
        dropzone.addEventListener('click', () => {
            fileInput.click();
        });

        function handleFiles(files) {
            const validTypes = ['application/pdf', 'application/msword', 
                              'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 
                              'text/plain'];
            const maxSize = 10 * 1024 * 1024; // 10MB

            files.forEach(file => {
                if (!validTypes.includes(file.type)) {
                    showAlert(`Arquivo "${file.name}" não é um formato válido.`, 'warning');
                    return;
                }

                if (file.size > maxSize) {
                    showAlert(`Arquivo "${file.name}" excede o tamanho máximo de 10MB.`, 'warning');
                    return;
                }

                // Verificar se já não foi adicionado
                if (!selectedFiles.find(f => f.name === file.name)) {
                    selectedFiles.push(file);
                }
            });

            updateFileList();
        }

        function updateFileList() {
            const fileList = document.getElementById('fileList');
            const selectedFilesDiv = document.getElementById('selectedFiles');

            if (selectedFiles.length === 0) {
                fileList.classList.remove('show');
                return;
            }

            fileList.classList.add('show');
            selectedFilesDiv.innerHTML = '';

            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item d-flex align-items-center justify-content-between p-2 border rounded mb-2';
                fileItem.innerHTML = `
                    <div class="d-flex align-items-center">
                        <i class="fas ${getFileIcon(file.type)} me-2"></i>
                        <div>
                            <div class="fw-medium">${file.name}</div>
                            <small class="text-muted">${formatFileSize(file.size)}</small>
                        </div>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeFile(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                selectedFilesDiv.appendChild(fileItem);
            });
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
        }

        function clearFiles() {
            selectedFiles = [];
            fileInput.value = '';
            updateFileList();
        }

        function getFileIcon(type) {
            switch (type) {
                case 'application/pdf':
                    return 'fa-file-pdf text-danger';
                case 'application/msword':
                case 'application/vnd.openxmlformats-officedocument.wordprocessingml.document':
                    return 'fa-file-word text-primary';
                case 'text/plain':
                    return 'fa-file-alt text-secondary';
                default:
                    return 'fa-file text-muted';
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function uploadFiles() {
            if (selectedFiles.length === 0) {
                showAlert('Selecione pelo menos um arquivo para upload.', 'warning');
                return;
            }

            const uploadProgress = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');

            uploadProgress.classList.add('show');
            progressBar.style.width = '0%';
            progressText.innerHTML = '<small class="text-muted">Iniciando upload...</small>';

            // Simular upload (em produção, usar FormData e fetch)
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    
                    setTimeout(() => {
                        uploadProgress.classList.remove('show');
                        showAlert(`${selectedFiles.length} arquivo(s) enviado(s) com sucesso!`, 'success');
                        clearFiles();
                        
                        // Redirecionar para documentos após upload
                        setTimeout(() => {
                            window.location.href = 'documents.html';
                        }, 2000);
                    }, 1000);
                }

                progressBar.style.width = progress + '%';
                progressText.innerHTML = `<small class="text-muted">Enviando... ${Math.round(progress)}%</small>`;
            }, 300);
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
            `;
            
            document.querySelector('.container').insertBefore(alertDiv, document.querySelector('.container').firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>
